# REST сервер на основе Spring Boot на языке Java

## Содержание
* [Общее устройство программы](#Общее-устройство-программы)
* [Допустимые запросы](#Допустимые-запросы-и-успешные-ответы-на-них)
* [Общий вид исключения](#Общий-вид-исключения)
* [Выполненные дополнительные задания](#Дополнительно-выполненные-задания)


## Общее устройство программы
В программе находятся 3 контроллера:
1) AccountsController
    * Регистрация пользователя(по умолчанию админ, 
   так как нет других механизмов 
   объявить пользователя админов в этой программе)
    * Просмотр состояния кошелька
    * Пополнение баланса
    * Снятие денег с баланса
    * Обмен валют по установленному курсу
2) RatesController
    * Просмотр текущего курса для заданной валюты
    * (Админ) Изменение курса валют
3) StatisticsController
   * (Админ) Просмотр суммы по валюте по кошелькам
   * (Админ) Просмотр количества проведенных транзакций за период. Эти контроллеры имеют требования к входящим запросам: используется валидация с помощью spring-boot-validation с требованием на не пустоту и соответствие regex.

Для обеспечения логической работы сервера используются 3 сервиса:
1) AccountService
   * Управляет процессами, заданными в контроллере AccountsController
2) AdministrationService
   * Управляет всеми процессами, требующими прав администратора
3) InformationService
   * Просмотр текущего курса для заданной валюты

Для хранения данных задействованны 4 таблицы в БД PostgreSQL, которым отвечают 4 entity объекта и 4 репозитория:
1) User
   * Хранит информацию о пользователях
2) ExchangeRate
   * Хранит информацию о текущих курсах обмена
3) ExchangeTransaction
   * Сохраняет историю всех операций обмена валют
4) InOutTransaction
   * Сохраняет историю всех операций ввода/вывода валют на баланс и с него

В результате работы программы могут возникнуть 6 возможных исключений:
1) InsufficientFundsException
   * На балансе недостаточно средств, возвращается код BAD_REQUEST
2) NotExistingCurrencyException
   * Такая валюта не поддерживается сервером, возвращается код BAD_REQUEST
3) RateUninitialisedException
   * Курс этой валюты не был определен, возвращается код SERVICE_UNAVAILABLE
4) UserNotAdminException
   * Операция требует прав администратора для выполнения, возвращается код UNAUTHORIZED
5) UserNotFoundException
   * Заданный пользователь не существует, возвращается код BAD_REQUEST
6) UserAlreadyExistsException
   * Заданные email или username уже заняты, возвращается код BAD_REQUEST

## Допустимые запросы и успешные ответы на них
В описании ошибок включены особенные ошибки, но в любом случае могут возникнуть
ошибки валидации запроса.

### Запросы по URI /statistics/
#### GET-запрос /statistics/transactions
Просмотр колличества всех транзакций среди всех пользователей в указзанном
интервале.

Тут могут возникнуть ошибки:
* UserNotAdminException
* UserNotFoundException

Корректный запрос:
      
      {
         "secret_key" : "строка",
         "date_from" : "YYYY-MM-DD hh-mm-ss",
         "date_to" : "YYYY-MM-DD hh-mm-ss"
      }

В случае успешного выполнения запроса:

      {
         "transaction_count" : "число"
      }

#### GET-запрос /statistics/wallets
Просмотр суммы по счетам всех пользователей по Валюте.

Тут могут возникнуть ошибки:
* NotExistingCurrencyException
* UserNotAdminException
* UserNotFoundException

Корректный запрос:

      {
         "secret_key" : "строка",
         "currency" : "строка"
      }

В качествет ответа на запрос будет возвращена сумма по всем кошелькам
пользователей для заданной валюты:

Например для запроса для TON:

      {
         "TON" : "число"
      }

### Запросы по URI /rates/
#### POST-запрос /rates/set
Задание новых курсов для валюты.

Тут могут возникнуть ошибки:
* NotExistingCurrencyException
* UserNotAdminException
* UserNotFoundException

Корректный запрос, пример для TON

      {
         "secret_key" : "строка",
         "base_currency" : "TON",
         "BTC" : "число",
         "RUB" : "число"
      }
В качестве ответа на успешно выполненный запрос придет такой же ответ, если бы 
делался запрос на просмотр текущих курсов для текущей валбты.

Например для запроса для TON:

      {
         "RUB" : "число",
         "BTC" : "число"
      }

#### GET-запрос /rates/
Просмотр текущих курсов для валюты.

Тут могут возникнуть ошибки:
* NotExistingCurrencyException

Корректный запрос:

      {
         "secret_key" : "строка",
         "currency" : "строка"
      }

В случае успешного выполнения запроса выведется список валют,
в которые возможно перевести из текущей валюты и соответсвующие курсы.

Например для запроса для TON:

      {
         "RUB" : "число",
         "BTC" : "число"
      }

### Запросы по URI /account/
##### POST-запрос /account/register
Регистрация нового пользователя.

Тут могут возникнуть ошибки:
* UserAlreadyExistsException

Корректный запрос:
      
      {
         "email" : "email",
         "username" : "username"
      }

В случае успешного выполнения запроса:

      {
         "secret_key" : "строка"
      }

#### GET-запрос /account/wallet
Просмотр текущего баланса на балансе

Тут могут возникнуть ошибки:
* UserNotFoundException

Корректный запрос:

      {
         "secret_key" : "строка"
      }

В случае успешного выполнения запроса:

      {
         "BTC_wallet" : "число",
         "RUB_wallet" : "число",
         "TON_wallet" : "число"
      }


#### POST-запрос /account/deposit
Пополнение баланса

Тут могут возникнуть ошибки:
* UserNotFoundException

Корректный запрос:

      {
         "secret_key" : "строка",
         "RUB_wallet" : "число",
         "BTC_wallet" : "число",
         "TON_wallet" : "число"
      }
В этом запросе поля RUB_wallet, BTC_wallet и TON_wallet опциональные,
то есть для успешного выполнения запроса они могут отсутствовать как по одиночке,
так и все сразу. Если они все отсутствуют, то изменение состояния не происходит.

В случае успешного выполнения запроса:

      {
         "BTC_wallet" : "число",
         "RUB_wallet" : "число",
         "TON_wallet" : "число"
      }
В этом ответе поля RUB_wallet, BTC_wallet и TON_wallet будут присутствовать, 
только если они были указаны в соответствующим запросе.


##### POST-запрос /account/withdraw
Выведение средств из кошелька.

Тут могут возникнуть ошибки:
* UserNotFoundException
* InsufficientFundsException
* NotExistingCurrencyException

Корректный запрос:

      {
         "secret_key" : "строка",
         "currency" : "строка",
         "count" : "число",
         "credit_card" : "строка"
      }
или 

      {
         "secret_key" : "строка",
         "currency" : "строка",
         "count" : "число",
         "wallet" : "строка"
      }

В случае успешного выполнения запроса придет обновленный баланс кошелька:

Например:

      {
         "RUB_wallet" : "число"
      }


##### POST-запрос /account/exchange
Обмен валют по текущему курсу.

Тут могут возникнуть ошибки:
* UserNotFoundException
* InsufficientFundsException
* NotExistingCurrencyException
* RateUninitialisedException

Корректный запрос:

      {
         "secret_key": "строка",
         "currency_from": "строка",
         "currency_to": "строка",
         "amount": "строка"
      }

В случае успешного выполнения запроса:

      {
         "currency_from": "строка",
         "currency_to": "строка",
         "amount_from": "число",
         "amount_to": "число"
      }


## Общий вид исключения
Исключения, генерируемые в ходе работы программы имеют вид:

      {
         "message": "строка",
         "httpStatus": "строка",
         "timeStamp": "время",
         "status": "число"
      }


## Дополнительно выполненные задания
* accept:application/xml is done.
* Подключена PostgreSQL, которая будет искать сервер PostgreSQL на localhost:5432